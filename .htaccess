# LiteSpeed Server Configuration for PHP 8.2
AddHandler application/x-httpd-php82 .php

# CORS Headers untuk mengatasi masalah Vite Development
<IfModule mod_headers.c>
    # Allow CORS for Vite development server
    Header always set Access-Control-Allow-Origin "*"
    Header always set Access-Control-Allow-Methods "GET, POST, PUT, DELETE, OPTIONS"
    Header always set Access-Control-Allow-Headers "Origin, X-Requested-With, Content-Type, Accept, Authorization, X-CSRF-Token"
    Header always set Access-Control-Allow-Credentials "true"
    
    # Handle preflight requests
    RewriteCond %{REQUEST_METHOD} OPTIONS
    RewriteRule ^(.*)$ $1 [R=200,L]
</IfModule>

# LiteSpeed specific settings
<IfModule LiteSpeed>
    RewriteEngine On
    
    # Handle Authorization Header
    RewriteCond %{HTTP:Authorization} .
    RewriteRule .* - [E=HTTP_AUTHORIZATION:%{HTTP:Authorization}]
    
    # Handle storage files PERTAMA - sangat penting untuk urutan
    RewriteCond %{REQUEST_URI} ^/storage/(.*)$
    RewriteCond %{DOCUMENT_ROOT}/public/storage/%1 -f
    RewriteRule ^storage/(.*)$ public/storage/$1 [L]
    
    # Handle build assets
    RewriteCond %{REQUEST_URI} ^/build/(.*)$
    RewriteCond %{DOCUMENT_ROOT}/public/build/%1 -f
    RewriteRule ^build/(.*)$ public/build/$1 [L]
    
    # Redirect all other requests to public folder
    RewriteCond %{REQUEST_URI} !^/public/
    RewriteCond %{REQUEST_URI} !^/storage/
    RewriteCond %{REQUEST_URI} !^/build/
    RewriteRule ^(.*)$ public/$1 [L]
</IfModule>

# Alternative Apache rewrite rules
<IfModule mod_rewrite.c>
    RewriteEngine On
    
    # Handle Authorization Header
    RewriteCond %{HTTP:Authorization} .
    RewriteRule .* - [E=HTTP_AUTHORIZATION:%{HTTP:Authorization}]
    
    # Handle storage files PERTAMA - sangat penting untuk urutan
    RewriteCond %{REQUEST_URI} ^/storage/(.*)$
    RewriteCond %{DOCUMENT_ROOT}/public/storage/%1 -f
    RewriteRule ^storage/(.*)$ public/storage/$1 [L]
    
    # Handle build assets
    RewriteCond %{REQUEST_URI} ^/build/(.*)$
    RewriteCond %{DOCUMENT_ROOT}/public/build/%1 -f
    RewriteRule ^build/(.*)$ public/build/$1 [L]
    
    # Redirect all other requests to public folder
    RewriteCond %{REQUEST_URI} !^/public/
    RewriteCond %{REQUEST_URI} !^/storage/
    RewriteCond %{REQUEST_URI} !^/build/
    RewriteRule ^(.*)$ public/$1 [L]
</IfModule>

# Security: Prevent access to sensitive files
<Files ".env">
    Order allow,deny
    Deny from all
</Files>

<Files "composer.json">
    Order allow,deny
    Deny from all
</Files>

<Files "composer.lock">
    Order allow,deny
    Deny from all
</Files>

<Files "artisan">
    Order allow,deny
    Deny from all
</Files>

# Prevent directory listing
Options -Indexes

# Set default index file
DirectoryIndex index.php

# PHP Settings for LiteSpeed
php_value memory_limit 512M
php_value max_execution_time 300
php_value upload_max_filesize 64M
php_value post_max_size 64M 